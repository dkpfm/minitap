<script setup>
import gsap from 'gsap'
import { ref, onMounted, watch, shallowRef, defineExpose } from 'vue'

const el = ref()

let tlRef = shallowRef()

defineExpose({
  tl: tlRef
})

watch(
  () => [el.value],
  () => {
    const miniLetters = [...el.value.querySelectorAll('#mini > path')]
    const tapLetters = [...el.value.querySelectorAll('#tap > path')]
    const star = el.value.querySelector('#star')

    // INITIAL STATE

    gsap.set(miniLetters, { opacity: 0 })
    gsap.set(tapLetters, { opacity: 0 })
    gsap.set(star, { opacity: 0 })

    const tl = new gsap.timeline()
    tlRef.value = tl
    tl.pause()

    tl.fromTo(
      miniLetters,
      { opacity: 0 },
      { opacity: 1, duration: 0.3, stagger: 0.05 },
      0
    )
    tl.fromTo(
      miniLetters,
      { scale: 0, rotation: -50, transformOrigin: 'center 80%' },
      { scale: 1, rotation: 0, ease: 'back.out', duration: 0.3, stagger: 0.05 },
      0
    )
    tl.fromTo(
      tapLetters,
      { opacity: 0 },
      { opacity: 1, duration: 0.3, stagger: 0.05 },
      0
    )
    tl.fromTo(
      tapLetters,
      { scale: 0, rotation: -50, transformOrigin: 'center 80%' },
      {
        scale: 1,
        rotation: 0,
        ease: 'back.out(3)',
        duration: 0.3,
        stagger: 0.05
      },
      0
    )
    tl.fromTo(
      star,
      { opacity: 0 },
      {
        opacity: 1,
        fill: 'orange',
        strokeWidth: 0,
        ease: 'circ.out',
        duration: 0.05
      },
      0.25
    )
    tl.fromTo(
      star,
      { scale: 0.5, transformOrigin: 'center center' },
      { scale: 3, ease: 'circ.out', duration: 0.2 },
      0.25
    )
    tl.to(
      star,
      {
        scale: 1,
        x: -3,
        y: 4,
        fill: 'black',
        strokeWidth: 1,
        ease: 'back.out(2)',
        duration: 0.2
      },
      0.5
    )
    tl.to(
      star,
      {
        x: 0,
        y: 0,
        ease: 'sine.out',
        duration: 0.15
      },
      0.7
    )
    tl.to(
      [...miniLetters, ...tapLetters],
      {
        scale: 0.6,
        x: (index) => {
          // console.log('hey', args)
          return 10 * (6 - index)
        },
        duration: 0.2,
        stagger: { from: 'end', each: 0.009 }
      },
      0.62 - 0.1
    )
    tl.to(
      [...miniLetters, ...tapLetters],
      {
        scale: 1,
        x: 0,
        ease: 'back.out(3)',
        duration: 0.3,
        stagger: { from: 'end', each: 0.009 }
      },
      0.7
    )
  }
)
</script>

<template>
  <div ref="el" class="logo">
    <svg
      width="286px"
      height="64px"
      viewBox="0 0 286 64"
      version="1.1"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
    >
      <g
        id="Page-1"
        stroke="none"
        stroke-width="1"
        fill="none"
        fill-rule="evenodd"
      >
        <g
          id="Rectangle-Copy-44"
          transform="translate(-407, -297)"
          fill="#000000"
        >
          <g id="Logo" transform="translate(407, 297)">
            <g id="mini" fill-rule="nonzero">
              <path
                d="M6.98935652,55.0885382 C11.1007427,55.0885382 14.0472361,52.7931825 14.0472361,47.8256215 L14.0472361,32.2720168 C14.0472361,28.9831488 15.7603137,26.9276064 18.6040225,26.9276064 C21.619039,26.9276064 23.1608088,28.7433355 23.1608088,32.3405349 L23.1608088,47.8256215 C23.1608088,52.7931825 25.6961637,55.0885382 29.8075498,55.0885382 C33.918936,55.0885382 36.4885524,52.7931825 36.4885524,47.8256215 L36.4885524,32.2720168 C36.4885524,28.9488898 38.1673684,26.9276064 41.0110772,26.9276064 C44.0603553,26.9276064 45.6021251,28.7090765 45.6021251,32.3062758 L45.6021251,47.8256215 C45.6021251,52.7931825 48.4800954,55.0885382 52.5914816,55.0885382 C56.7028678,55.0885382 59.6493612,52.7931825 59.6493612,47.8256215 L59.6493612,28.6748175 C59.6493612,20.9665332 54.5786516,15.6563818 47.212418,15.6563818 C41.4564774,15.6563818 36.8654295,18.9795088 35.5977521,23.9813288 L35.3236596,23.9813288 C34.3985978,18.6711774 30.561304,15.6563818 24.8053633,15.6563818 C19.631869,15.6563818 15.3834366,18.9452498 13.978713,24.0498469 L13.7046206,24.0498469 L13.7046206,22.7137443 C13.7046206,17.7804424 10.8951734,15.5536047 6.85231031,15.5536047 C2.80944723,15.5536047 0,17.8147014 0,22.7137443 L0,47.8256215 C0,52.7931825 2.87797033,55.0885382 6.98935652,55.0885382 Z"
                id="Path"
              ></path>
              <path
                d="M70.4965685,13.292508 C74.4709084,13.292508 77.485925,10.4147485 77.485925,6.64625399 C77.485925,2.87775946 74.4709084,0 70.4965685,0 C66.5222285,0 63.5072119,2.87775946 63.5072119,6.64625399 C63.5072119,10.4147485 66.5222285,13.292508 70.4965685,13.292508 Z M70.4965685,55.0885382 C74.9505702,55.0885382 77.5201865,52.450592 77.5201865,47.8256215 L77.5201865,22.8507805 C77.5201865,18.2258099 74.9505702,15.5536047 70.4965685,15.5536047 C66.0425668,15.5536047 63.4729504,18.1915509 63.4729504,22.8165214 L63.4729504,47.8256215 C63.4729504,52.450592 66.0425668,55.0885382 70.4965685,55.0885382 Z"
                id="Shape"
              ></path>
              <path
                d="M88.5044399,55.0885382 C92.6158261,55.0885382 95.528058,52.7931825 95.528058,47.8256215 L95.528058,33.0942338 C95.528058,29.5655525 97.5494896,26.9961244 100.87286,26.9961244 C104.4018,26.9961244 106.183401,29.3257392 106.183401,33.1284928 L106.183401,47.8256215 C106.183401,52.7931825 109.095632,55.0885382 113.207019,55.0885382 C117.318405,55.0885382 120.230637,52.7931825 120.230637,47.8256215 L120.230637,30.0109201 C120.230637,20.9322742 115.571066,15.6563818 107.074201,15.6563818 C101.31826,15.6563818 97.7207973,18.1915509 95.8021504,23.5017022 L95.528058,23.5017022 L95.528058,22.6452262 C95.528058,18.1230328 92.6843492,15.5536047 88.2988706,15.5536047 C83.913392,15.5536047 81.4808219,18.1230328 81.4808219,22.6109672 L81.4808219,47.8256215 C81.4808219,52.7931825 84.3930538,55.0885382 88.5044399,55.0885382 Z"
                id="Path"
              ></path>
              <path
                d="M131.043582,13.292508 C135.017922,13.292508 138.032939,10.4147485 138.032939,6.64625399 C138.032939,2.87775946 135.017922,0 131.043582,0 C127.069242,0 124.054226,2.87775946 124.054226,6.64625399 C124.054226,10.4147485 127.069242,13.292508 131.043582,13.292508 Z M131.043582,55.0885382 C135.497584,55.0885382 138.0672,52.450592 138.0672,47.8256215 L138.0672,22.8507805 C138.0672,18.2258099 135.497584,15.5536047 131.043582,15.5536047 C126.589581,15.5536047 124.019964,18.1915509 124.019964,22.8165214 L124.019964,47.8256215 C124.019964,52.450592 126.589581,55.0885382 131.043582,55.0885382 Z"
                id="Shape"
              ></path>
            </g>
            <g
              id="tap"
              transform="translate(143.5306, 8.747)"
              fill-rule="nonzero"
            >
              <path
                d="M6.66414274,0 C9.78557249,0 12.3259588,2.48867633 12.3259588,5.57087614 L12.3243277,10.6840849 L32.3898199,10.6851434 L32.3898199,17.2380191 C32.3898199,20.32033 29.8497422,22.8088953 26.7280039,22.8088953 L13.8538234,22.8088953 C13.0047437,22.8088953 12.3259588,23.4739144 12.3259588,24.2818938 L12.3259588,30.9727468 C12.3259588,31.7807261 13.0047437,32.4457453 13.8538234,32.4457453 L31.9709735,32.4453287 C35.0924032,32.4453287 37.6327895,34.934005 37.6327895,38.0162048 L37.6327895,44.5690806 L13.6973423,44.5690806 C6.13787929,44.5690806 0,38.5556775 0,31.1256388 L0,0 L6.66414274,0 Z"
                id="Path"
              ></path>
              <path
                d="M84.7792644,10.6847296 L84.7792644,44.5686677 L78.1151217,44.5686677 C74.9933834,44.5686677 72.4533056,42.0801016 72.4533056,38.9977906 L72.4518187,22.806589 L52.3853697,22.8080658 C51.6016037,22.8080658 50.9629411,23.3747093 50.869323,24.0973829 L50.857505,24.2810643 L50.857505,30.9719173 C50.857505,31.7798967 51.5362899,32.4449158 52.3853697,32.4449158 L70.0954303,32.4449158 L70.0954303,38.9977916 C70.0954303,42.0799914 67.555044,44.5686677 64.4336142,44.5686677 L52.2288885,44.5686677 C44.6694255,44.5686677 38.5315462,38.5552647 38.5315462,31.125226 L38.5315462,24.1281723 C38.5315462,16.6981333 44.6694248,10.6847296 52.2288875,10.6847296 L84.7792644,10.6847296 Z"
                id="Path"
              ></path>
              <path
                d="M120.197578,10.6839001 C127.757041,10.6839001 133.894921,16.6973031 133.894921,24.1273419 L133.894921,31.1243955 C133.894921,38.5544345 127.757042,44.5678382 120.197579,44.5678382 L99.9727692,44.567055 L99.9731613,49.6821055 C99.9731613,52.6542267 97.6109909,55.074462 94.6434716,55.2435449 L94.3113453,55.2529816 L87.6472026,55.2529816 L87.6472026,24.1273428 C87.6472026,16.6973038 93.7850811,10.6839001 101.344544,10.6839001 L120.197578,10.6839001 Z M120.041097,22.807652 L101.501025,22.807652 C100.651945,22.807652 99.9731604,23.4726712 99.9731604,24.2806506 L99.9731604,30.9715035 C99.9731604,31.7794829 100.651945,32.4445021 101.501025,32.4445021 L120.041097,32.4445021 C120.890177,32.4445021 121.568962,31.7794829 121.568962,30.9715035 L121.568962,24.2806506 C121.568962,23.4726712 120.890177,22.807652 120.041097,22.807652 Z"
                id="Combined-Shape"
              ></path>
            </g>
            <path
              d="M273.646908,9.43532029 L275.476882,17.695812 L282.837092,14.0379891 L277.699178,20.542965 L285.165568,24.1857273 L276.904333,24.0688515 L277.802634,29.5684318 L274.320708,26.2668144 L267.491052,34.2923832 L269.676535,23.9878973 L264.086231,23.4695784 L269.74146,20.5100071 L264.496518,13.9074032 L271.921808,17.6698788 L273.646908,9.43532029 Z"
              id="star"
              stroke="#fff"
              stroke-width="0.75"
              transform="translate(274.4389, 22.0685) rotate(-345) translate(-274.4389, -22.0685)"
            ></path>
          </g>
        </g>
      </g>
    </svg>
  </div>
</template>

<style lang="scss" scoped>
svg {
  overflow: visible;
}
</style>
